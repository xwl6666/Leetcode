## 3007. 价值和小于等于 K 的最大数字

LeetCode：[3007. 价值和小于等于 K 的最大数字](https://leetcode.cn/problems/maximum-number-that-sum-of-the-prices-is-less-than-or-equal-to-k/)，难度：中等。

### 题解

#### 题目解释

```c++
// 0001  1
// 0010  2          1     = 2
// 0011  3          1 + 1 = 2
// 0100  4                  2
// 0101  5                  2
// 0110  6          2 + 1 = 3
// 0111  7          3 + 1 = 4
// 1000  8          4 + 1 = 5 < 7
// 1001  9          5 + 1 = 6 < 7  ans = 9
// 1010  10         6 + 2 = 8 > 7
```

#### 代码

```c++
class Solution {
public:

    #define ll long long

    ll k, x;

    ll get(ll num, ll cnt) {  // 1 到 x 闭区间中，有多少个数，这个数的二进制第 k 位是1
        // 对于二进制的第 k 位，每 2^k 个数形成一个循环；前 2^(k-1) 个数为 0，后 2^(k-1) 个数为 1
        ll mod = pow(2, cnt), pre = pow(2, cnt - 1), sum = num / mod;
        ll yu = num % mod;
        ll res = sum * pow(2, cnt - 1);
        if (yu > pre) {
            res += yu - pre;
        }
        return res;
    }

    bool judge(ll now) {  // [1, now]  数位 % x == 0 且数位为 1，价值总和是否小于 k
        ll sum = 0, bas = 1, cnt = 1;  // cnt 数位  bas = 2 ^ (cnt - 1)
        while(bas <= now) {
            if(cnt % x == 0) {
                sum += get(now, cnt);
                if(sum > k) {
                    return false;
                }
            }
            bas = bas * 2;
            cnt ++;
        }
        sum += get(now, cnt);
        return sum <= k;
    }

    ll findMaximumNumber(ll k, int x) {
        // 计算 [1, now]，对于每个数字，转二进制之后，数位模 x = 0 时且数位为 1 的价值总和
        this -> k = k, this -> x = x;
        ll l = 1, r = 1e18, mid, ans = 0;
        while(l <= r) {
            mid = (l + r) / 2;
            if(judge(mid)) {
                ans = mid;
                l = mid + 1;
            } else {
                r = mid - 1;
            }
        }

        return ans - 1;
    }
};
```



---



### 题目

给你一个整数 `k` 和一个整数 `x` 。

令 `s` 为整数 `num` 的下标从 **1** 开始的二进制表示。我们说一个整数 `num` 的 **价值** 是满足 `i % x == 0` 且 `s[i]` 是 **设置位** 的 `i` 的数目。

请你返回 **最大** 整数 `num` ，满足从 `1` 到 `num` 的所有整数的 **价值** 和小于等于 `k` 。

**注意：**

- 一个整数二进制表示下 **设置位** 是值为 `1` 的数位。
- 一个整数的二进制表示下标从右到左编号，比方说如果 `s == 11100` ，那么 `s[4] == 1` 且 `s[2] == 0` 。

 

**示例 1：**

```
输入：k = 9, x = 1
输出：6
解释：数字 1 ，2 ，3 ，4 ，5 和 6 二进制表示分别为 "1" ，"10" ，"11" ，"100" ，"101" 和 "110" 。
由于 x 等于 1 ，每个数字的价值分别为所有设置位的数目。
这些数字的所有设置位数目总数是 9 ，所以前 6 个数字的价值和为 9 。
所以答案为 6 。
```

**示例 2：**

```
输入：k = 7, x = 2
输出：9
解释：由于 x 等于 2 ，我们检查每个数字的偶数位。
2 和 3 在二进制表示下的第二个数位为设置位，所以它们的价值和为 2 。
6 和 7 在二进制表示下的第二个数位为设置位，所以它们的价值和为 2 。
8 和 9 在二进制表示下的第四个数位为设置位但第二个数位不是设置位，所以它们的价值和为 2 。
数字 1 ，4 和 5 在二进制下偶数位都不是设置位，所以它们的价值和为 0 。
10 在二进制表示下的第二个数位和第四个数位都是设置位，所以它的价值为 2 。
前 9 个数字的价值和为 6 。
前 10 个数字的价值和为 8，超过了 k = 7 ，所以答案为 9 。
```

 

**提示：**

- `1 <= k <= 10^15`
- `1 <= x <= 8`


